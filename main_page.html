<!doctype html>
<html>

  <head>
    <title>Mordor.js: One does not simply check in code</title>
    <link href="/static/index.css" rel="stylesheet">
    <script src="/bower/jquery/jquery.js" type="text/javascript"></script>
    <script src="/bower/lodash/dist/lodash.js" type="text/javascript"></script>
    <script src="/static/index.js" type="text/javascript"></script>
  </head>

  <body>
    <h1>Regex builder for source code</h1>
    <form method="post" action="/" class="rule-form">
      <iframe src="http://nodeknockout.com/iframe/all-seeing-eye" frameborder=0 scrolling=no allowtransparency=true width=115 height=25>
      </iframe>
      <ul class="rule-list"></ul>
      <h3>Example rules:</h3>
      <ul class="example-rules">
        <li><a href="javascript:void(0)" data-rule="variable > id">Variable Names</a></li>
        <li><a href="javascript:void(0)" data-rule="call:contains(writeFile)">Calls to WriteFile</a></li>
      </ul>
      <label for="rule">Rule:</label><input type="text" id="rule" name="rule" value="<%- rule %>"/>
      <input type="color" id="color" name="color"  />
      <a class="btn js-add-rule">Add Rule</a>
      <br />
      <a class="js-example-redis" href="javascript:void(0);">Load Example Script</a>
      <br />
      <label for="source">Source Code</label>
      &mdash;
      <a class="btn js-parse">Parse</a><br />
      <textarea rows="30" cols="80" id="source" name="source"><%= source %></textarea><br />
    </form>
    <pre id="rendered-code"><code>
<%= code %>
    </pre></code>



  
  <div class="source-example" id="node_redis__generate_commands">// Copied from https://raw.github.com/mranney/node_redis/master/generate_commands.js
var http = require("http"),
    fs = require("fs");

function prettyCurrentTime() {
    var date = new Date();
    return date.toLocaleString();
}

function write_file(commands, path) {
    var file_contents, out_commands;

    console.log("Writing " + Object.keys(commands).length + " commands to " + path);

    file_contents = "// This file was generated by ./generate_commands.js on " + prettyCurrentTime() + "\n";

    out_commands = Object.keys(commands).map(function (key) {
        return key.toLowerCase();
    });

    file_contents += "module.exports = " + JSON.stringify(out_commands, null, "    ") + ";\n";

    fs.writeFile(path, file_contents);
}

http.get({host: "redis.io", path: "/commands.json"}, function (res) {
    var body = "";

    console.log("Response from redis.io/commands.json: " + res.statusCode);

    res.on('data', function (chunk) {
        body += chunk;
    });

    res.on('end', function () {
        write_file(JSON.parse(body), "lib/commands.js");
    });
}).on('error', function (e) {
    console.log("Error fetching command list from redis.io: " + e.message);
});
  </div>

  </body>
</html>
